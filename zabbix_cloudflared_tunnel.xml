zabbix_export:
  version: '5.4'
  date: '2021-10-19T18:04:35Z'
  groups:
    -
      uuid: e509b376b9d642c1957531dc7d8dea40
      name: CloudflareTunnels
    -
      uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
      name: Templates/Applications
  templates:
    -
      uuid: e14ebe496234412f953ef2e34cf6de0b
      template: 'Cloudflared Tunnel Metrics'
      name: 'Cloudflared Tunnel Metrics'
      description: 'Tunnel Metrics for Cloudflare Argo Tunnel Service'
      groups:
        -
          name: CloudflareTunnels
        -
          name: Templates/Applications
      items:
        -
          uuid: 06017602bc694f448bdfdba021529e9d
          name: 'CF Active Streams'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_active_streams
          delay: '0'
          units: Streams
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - cloudflared_tunnel_active_streams
                - ''
          master_item:
            key: 'web.page.get[{$CLOUDFLARED_METRICS_HOST},{$CLOUDFLARED_METRICS_PATH},{$CLOUDFLARED_METRICS_PORT}]'
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: 462308962e874fbdb191eea88342c7dd
          name: 'CF Active Streams (Change)'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_active_streams.change
          delay: '0'
          preprocessing:
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: cf.cloudflared_tunnel_active_streams
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: 460fb27ff4a04da3929892bae3ac938d
          name: 'CF HA Connections'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_ha_connections
          delay: '0'
          units: Connections
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - cloudflared_tunnel_ha_connections
                - ''
          master_item:
            key: 'web.page.get[{$CLOUDFLARED_METRICS_HOST},{$CLOUDFLARED_METRICS_PATH},{$CLOUDFLARED_METRICS_PORT}]'
          tags:
            -
              tag: Application
              value: Cloudflare
          triggers:
            -
              uuid: 27914c6bc3544385962c0bcd2f194f3c
              expression: 'last(/Cloudflared Tunnel Metrics/cf.cloudflared_tunnel_ha_connections)<{$CLOUDFLARED_TRIGGER_HA_CONNECTIONS}'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'last(/Cloudflared Tunnel Metrics/cf.cloudflared_tunnel_ha_connections)>={$CLOUDFLARED_TRIGGER_HA_CONNECTIONS}'
              name: 'Cloudflare HA Connections < {$CLOUDFLARED_TRIGGER_HA_CONNECTIONS}'
              event_name: 'Cloudflare HA Connections < {$CLOUDFLARED_TRIGGER_HA_CONNECTIONS}'
              opdata: cf.cloudflared_tunnel_ha_connections
              priority: WARNING
              manual_close: 'YES'
              tags:
                -
                  tag: Application
                  value: Cloudflare
        -
          uuid: 10c75c39cc1b4008b91ea482102a9818
          name: 'CF HA Connections (Change)'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_ha_connections.change
          delay: '0'
          units: Connections
          preprocessing:
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: cf.cloudflared_tunnel_ha_connections
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: 1d0f7504a5af4417b84fb53d887d0ebb
          name: 'CF Tunnel 200 Responses'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_response_by_code_200
          delay: '0'
          units: Responses
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - 'cloudflared_tunnel_response_by_code{status_code="200"}'
                - ''
          master_item:
            key: 'web.page.get[{$CLOUDFLARED_METRICS_HOST},{$CLOUDFLARED_METRICS_PATH},{$CLOUDFLARED_METRICS_PORT}]'
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: e54ecb9581a142f588b9fdee0224a960
          name: 'CF Tunnel 200 Responses (Change)'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_response_by_code_200.change
          delay: '0'
          units: Requests
          preprocessing:
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: cf.cloudflared_tunnel_response_by_code_200
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: 388e8023e8524d2494e14efa5823f5db
          name: 'CF Tunnel 404 Responses'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_response_by_code_404
          delay: '0'
          units: Responses
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - 'cloudflared_tunnel_response_by_code{status_code="404"}'
                - ''
          master_item:
            key: 'web.page.get[{$CLOUDFLARED_METRICS_HOST},{$CLOUDFLARED_METRICS_PATH},{$CLOUDFLARED_METRICS_PORT}]'
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: 188d027996424162af25f4d3ecdce724
          name: 'CF Tunnel 404 Responses (Change)'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_response_by_code_404.change
          delay: '0'
          preprocessing:
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: cf.cloudflared_tunnel_response_by_code_404
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: f6a1519e1f1448cbb6b0e3a17da17cc6
          name: 'CF Tunnel Unacknowledged Heartbeats'
          type: DEPENDENT
          key: cf.cloudflared_tunnel_timer_retries
          delay: '0'
          units: Responses
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - cloudflared_tunnel_timer_retries
                - ''
          master_item:
            key: 'web.page.get[{$CLOUDFLARED_METRICS_HOST},{$CLOUDFLARED_METRICS_PATH},{$CLOUDFLARED_METRICS_PORT}]'
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: bdb07d3626394253bd2d3efdd4794af3
          name: 'CF Cloudflared Version'
          type: ZABBIX_ACTIVE
          key: cf.version
          delay: 1h
          trends: '0'
          value_type: TEXT
          description: 'Cloudflared Version'
          preprocessing:
            -
              type: STR_REPLACE
              parameters:
                - 'cloudflared version'
                - ''
          tags:
            -
              tag: Application
              value: Cloudflare
            -
              tag: Cloudflared
              value: Version
          triggers:
            -
              uuid: f0254e1ca7ff43c98d056d147c6315ce
              expression: 'change(/Cloudflared Tunnel Metrics/cf.version)<>0'
              recovery_mode: NONE
              name: 'CF Cloudflared Version Changed'
              event_name: 'CF Cloudflared Version Changed'
              opdata: cf.version
              priority: INFO
              manual_close: 'YES'
              tags:
                -
                  tag: Application
                  value: Cloudflare
            -
              uuid: 2c90b990717b47bfa91bf84af9829ed8
              expression: 'change(/Cloudflared Tunnel Metrics/cf.version)<>{$CLOUDFLARED_VERSION_EXPECT}'
              recovery_mode: NONE
              name: 'CF Cloudflared Version Not Expected'
              event_name: 'CF Cloudflared Version Not Expected'
              opdata: cf.version
              priority: INFO
              manual_close: 'YES'
              tags:
                -
                  tag: Application
                  value: Cloudflare
        -
          uuid: 3eb5a6ef950f40fa93d3441f24dc9542
          name: 'CF Tunnel Total Proxied Requests'
          type: DEPENDENT
          key: cloudflared_tunnel_total_requests
          delay: '0'
          units: Responses
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - cloudflared_tunnel_total_requests
                - ''
          master_item:
            key: 'web.page.get[{$CLOUDFLARED_METRICS_HOST},{$CLOUDFLARED_METRICS_PATH},{$CLOUDFLARED_METRICS_PORT}]'
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: 600a9d2fbdb74821834eb1d4e4a664f9
          name: 'CF Tunnel Total Requests (Change)'
          type: DEPENDENT
          key: cloudflared_tunnel_total_requests.change
          delay: '0'
          preprocessing:
            -
              type: SIMPLE_CHANGE
              parameters:
                - ''
          master_item:
            key: cloudflared_tunnel_total_requests
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: 95ea3e0172794774baabb8b61fa33198
          name: 'CF Tunnel Authentication Success'
          type: DEPENDENT
          key: cloudflared_tunnel_tunnel_authenticate_success
          delay: '0'
          units: Responses
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - cloudflared_tunnel_tunnel_authenticate_success
                - ''
          master_item:
            key: 'web.page.get[{$CLOUDFLARED_METRICS_HOST},{$CLOUDFLARED_METRICS_PATH},{$CLOUDFLARED_METRICS_PORT}]'
          tags:
            -
              tag: Application
              value: Cloudflare
        -
          uuid: e2bc58f77253494cbafa6df21034ebb5
          name: cf.metrics
          type: ZABBIX_ACTIVE
          key: 'web.page.get[{$CLOUDFLARED_METRICS_HOST},{$CLOUDFLARED_METRICS_PATH},{$CLOUDFLARED_METRICS_PORT}]'
          history: '0'
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: REGEX
              parameters:
                - '\n\s?\n([\s\S]*)'
                - \1
          tags:
            -
              tag: Application
              value: Cloudflare
      tags:
        -
          tag: Application
          value: Cloudflare
      macros:
        -
          macro: '{$CLOUDFLARED_METRICS_HOST}'
          value: 127.0.0.1
          description: 'CloduflareD Metrics Tunnel Host'
        -
          macro: '{$CLOUDFLARED_METRICS_PATH}'
          value: metrics
          description: 'CloduflareD Metrics Tunnel Path'
        -
          macro: '{$CLOUDFLARED_METRICS_PORT}'
          value: '40705'
          description: 'CloduflareD Metrics Tunnel Port'
        -
          macro: '{$CLOUDFLARED_TRIGGER_HA_CONNECTIONS}'
          value: '4'
          description: 'CloduflareD Metrics Trigger HA Connection WARN'
        -
          macro: '{$CLOUDFLARED_TUNNEL_ID}'
          value: 0000-0000-0000-0000
          description: 'FUTURE DEVELOPMENT'
      dashboards:
        -
          uuid: e49a2fd1ddd24056b7730b10dad3736e
          name: 'Clouflared Tunnel Metrics'
          pages:
            -
              widgets:
                -
                  type: GRAPH_CLASSIC
                  name: 'Active Streams'
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'CF Active Streams'
                        host: 'Cloudflared Tunnel Metrics'
                -
                  type: GRAPH_CLASSIC
                  name: 'Authentication Successes'
                  x: '12'
                  'y': '10'
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'CF Authentication Success'
                        host: 'Cloudflared Tunnel Metrics'
                -
                  type: GRAPH_CLASSIC
                  name: 'HA Connections'
                  x: '12'
                  'y': '5'
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'CF HA Connections'
                        host: 'Cloudflared Tunnel Metrics'
                -
                  type: GRAPH_CLASSIC
                  name: 'Timer Retries'
                  'y': '10'
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'CF Tunnel Timer Retries'
                        host: 'Cloudflared Tunnel Metrics'
                -
                  type: GRAPH_CLASSIC
                  name: 'Tunnel Responses'
                  'y': '5'
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'CF HTTP Tunnel Responses'
                        host: 'Cloudflared Tunnel Metrics'
  graphs:
    -
      uuid: ef84f2056f9f431d8096c40799b1177c
      name: 'CF Active Streams'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Cloudflared Tunnel Metrics'
            key: cf.cloudflared_tunnel_active_streams
    -
      uuid: 1a37c5d762a844a98ed677ae98bcab48
      name: 'CF Authentication Success'
      graph_items:
        -
          sortorder: '1'
          color: F63100
          item:
            host: 'Cloudflared Tunnel Metrics'
            key: cloudflared_tunnel_tunnel_authenticate_success
    -
      uuid: 04091f1019a444b9962a16d82149437f
      name: 'CF HA Connections'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Cloudflared Tunnel Metrics'
            key: cf.cloudflared_tunnel_ha_connections
    -
      uuid: a924b889542e4ce6b88a082aab81177c
      name: 'CF HTTP Tunnel Responses'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Cloudflared Tunnel Metrics'
            key: cf.cloudflared_tunnel_response_by_code_200
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Cloudflared Tunnel Metrics'
            key: cf.cloudflared_tunnel_response_by_code_404
        -
          sortorder: '3'
          drawtype: DOTTED_LINE
          color: 2774A4
          item:
            host: 'Cloudflared Tunnel Metrics'
            key: cloudflared_tunnel_total_requests
    -
      uuid: a3e2d04de5834c73a5973139403b13ae
      name: 'CF Tunnel Timer Retries'
      graph_items:
        -
          sortorder: '1'
          color: 1A7C11
          item:
            host: 'Cloudflared Tunnel Metrics'
            key: cf.cloudflared_tunnel_timer_retries
